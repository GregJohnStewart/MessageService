<!DOCTYPE html>
<html lang="en_us">
<head>
	<meta charset="UTF-8">
	<title>Landing Page - Viewer</title>
	<link rel="stylesheet" href="/res/lib/bootstrap/5.3.3/css/bootstrap.min.css">
	<link rel="stylesheet" href="/res/lib/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css">
	<link rel="stylesheet" href="/res/css/main.css">
	<style>
	</style>
</head>
<body class="min-vh-100 vstack">
{#let priorityMessages = cdi:PriorityMessageRepository.getMessagesToDisplay()}
	<div class="container-fluid min-vh-100 d-flex flex-column">
		<main id="content">
			<div class="row mb-3 mt-1">
				<div class="col-6">
					<h1 class="text-light align-middle">Messages</h1>
				</div>
				{#if userLoggedIn}
					<div class="col-6 text-end">
						<a href="/landpageManage" class="btn btn-primary btn-sm">Edit</a>
					</div>
				{/if}
			</div>
			<div id="message-table" class="table-container">
				<table class="table table-striped table-hover opacity-75">
					<thead>
					<tr>
						<th>Subject</th>
						<th style="width:10%">Priority</th>
						<th style="width:10%">Start Date</th>
						<th style="width:10%">End Date</th>
					</tr>
					</thead>
					<tbody>
					{#if priorityMessages.isEmpty}
						<tr>
							<td colspan="4" class="text-center">
								No Messages to display!
							</td>
						</tr>
					{#else}
						{#for message in priorityMessages}
							<tr id="message-row-{message.id}" data-bs-toggle="modal" data-bs-target="#infoModal" data-message-data="{message.toJSON()}" onclick="showDetails('{message.id}')">
								<td>
									{message.subject}
								</td>
								<td>
									{message.priority}
								</td>
								<td>
									{message.getFormattedStartDate()}
								</td>
								<td>
									{message.getFormattedEndDate()}
								</td>
							</tr>
						{/for}
					{/if}
					</tbody>
				</table>
			</div>
		</main>
	</div>

	<div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="modalTitle" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Message Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
					<dl class="row">
						<dt class="col-sm-3">Subject:</dt>
						<dd class="col-sm-9" id="subject"></dd>
						<dt class="col-sm-3">Message:</dt>
						<dd class="col-sm-9" id="message"></dd>
						<dt class="col-sm-3">Priority:</dt>
						<dd class="col-sm-9" id="priority"></dd>
						<dt class="col-sm-3">Start Date:</dt>
						<dd class="col-sm-9" id="startDate"></dd>
						<dt class="col-sm-3">End Date:</dt>
						<dd class="col-sm-9" id="endDate"></dd>
						<dt class="col-sm-3">Last Updated By:</dt>
						<dd class="col-sm-9" id="lastUpdatedBy"></dd>
						<dt class="col-sm-3">Last Updated:</dt>
						<dd class="col-sm-9" id="lastUpdated"></dd>
						<dt class="col-sm-3">Created By:</dt>
						<dd class="col-sm-9" id="createdBy"></dd>
						<dt class="col-sm-3">Created At:</dt>
						<dd class="col-sm-9" id="createdAt"></dd>
					  </dl>
				</div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
	<script src="/res/lib/jquery/3.7.1/jquery.min.js"></script>
	<script src="/res/lib/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
	<script>
		function stripQuotes(str) {
			if (str.startsWith('"') || str.startsWith("'")) {
				str = str.slice(1);
			}
			if (str.endsWith('"') || str.endsWith("'")) {
				str = str.slice(0, -1);
			}
			return str;
		}

		function showDetails(messageId) {
			jsonmessage = document.getElementById('message-row-' + messageId).dataset.messageData;

			console.log("View JSON Message: " + jsonmessage);

			message = JSON.parse(stripQuotes(jsonmessage));

			document.getElementById('subject').innerText = message.subject;
			document.getElementById('message').innerText = message.content;
			document.getElementById('priority').innerText = message.priority;
			document.getElementById('startDate').innerText = message.startDate;
			document.getElementById('endDate').innerText = message.endDate;
			document.getElementById('lastUpdatedBy').innerText = message.lastUpdatedBy;
			document.getElementById('lastUpdated').innerText = message.lastUpdated;
			document.getElementById('createdBy').innerText = message.createdBy;
			document.getElementById('createdAt').innerText = message.createdAt;
		}
	</script>

</body>
</html>